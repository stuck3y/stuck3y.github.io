<!--  hn-clear.html  ‚Äì v3  -->
<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>Hacker¬†News¬†‚Äì¬†Simple</title>
<link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css">
<style>
:root{
  --orange:#ff6600;
  --radius:12px;
  --anim:.18s cubic-bezier(.25,.8,.5,1);
}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{height:100%;margin:0;font:-apple-system-body;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
  background:#f7f7f7;}
header{background:var(--orange);color:#fff;padding:.7rem 1.2rem;font-weight:600;
  font-size:1.2rem;}
#toolbar{display:flex;gap:.6rem;padding:.6rem 1rem;position:relative}
button{background:var(--orange);color:#fff;border:0;border-radius:var(--radius);
  padding:.55rem .95rem;font-size:1rem;cursor:pointer;transition:opacity var(--anim)}
button:active{opacity:.7}
button[disabled]{opacity:.4}
button.secondary{background:#dadada;color:#333}
.spin{display:inline-block;width:1.1em;height:1.1em;border:.19em solid rgba(255,255,255,.4);
  border-top-color:#fff;border-radius:50%;animation:spin 1s linear infinite;vertical-align:-.15em}
@keyframes spin{to{transform:rotate(360deg)}}

ul#stories{list-style:none;margin:0;padding:0}
li.story{background:#fff;margin:.55rem 0;padding:.9rem 1rem;border-radius:var(--radius);
  display:flex;align-items:center;gap:.9rem;position:relative;touch-action:none;
  box-shadow:0 1px 2px rgba(0,0,0,.06);transition:transform var(--anim),box-shadow var(--anim)}
li.dragging{box-shadow:0 8px 12px rgba(0,0,0,.15);transform:scale(.97)}
.drag-handle{font-size:1.4rem;cursor:grab;user-select:none;touch-action:none}
a.title{flex:1;font-size:1rem;font-weight:500;text-decoration:none;color:#000}
.points{background:var(--orange);color:#fff;border-radius:6px;padding:.2rem .55rem;font-size:.75rem}
a.comments{margin-right:.2rem;color:#555;text-decoration:none;font-size:1.2rem}
.checkbox{display:none;margin-right:.4rem}
.selecting li .checkbox{display:block}
.checkbox input{width:22px;height:22px}

.swipe-delete{position:absolute;top:0;right:-80px;height:100%;display:flex;
  align-items:center;gap:.25rem;padding:0 .8rem;transition:right var(--anim)}
.swipe-delete button{background:#e74c3c;border:0;border-radius:8px;padding:.6rem .9rem;
  display:flex;align-items:center;gap:.4rem}
.swipe-delete svg{width:1.1rem;height:1.1rem;fill:#fff}

#fab{position:fixed;bottom:calc(env(safe-area-inset-bottom) + 1rem);left:50%;
  transform:translateX(-50%);background:var(--orange);color:#fff;border-radius:999px;
  padding:.6rem 1.4rem;font-weight:600;display:none;box-shadow:0 4px 14px rgba(0,0,0,.2);
  cursor:pointer;transition:transform var(--anim)}
#fab.show{display:block;animation:fadeIn .25s ease-out}
@keyframes fadeIn{from{opacity:0;transform:translate(-50%,1rem)}to{opacity:1}}

#modal{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;
  align-items:center;justify-content:center;padding:1rem;z-index:1000}
#modal .card{background:#fff;border-radius:var(--radius);max-width:650px;width:100%;
  max-height:90vh;overflow:auto;position:relative;padding:1rem}
#modal header{font-size:1.25rem;font-weight:700;margin-bottom:.4rem}
#modal .close{position:absolute;top:.4rem;right:.8rem;font-size:1.6rem;color:#555;cursor:pointer}
#modal textarea{border:1px solid #ccc;border-radius:8px;padding:.7rem;font-size:.95rem}
.copy-btn{margin-top:.7rem;background:#2ecc71}

#toast{position:fixed;top:0;left:0;right:0;background:#333;color:#fff;text-align:center;
  padding:.4rem 0;font-size:.9rem;transform:translateY(-120%);transition:transform var(--anim);
  z-index:1500}
#toast.show{transform:translateY(0)}

@keyframes slideIn{from{transform:translateX(100%)}to{transform:none}}

.empty{padding:3rem 2rem;text-align:center;color:#999}
.empty svg{width:120px;height:120px;opacity:.6;margin-bottom:1rem}
@media (prefers-reduced-motion:reduce){
  *{transition:none!important;animation:none!important}
}
</style>
</head><body>
<header>Hacker¬†News¬†‚Äì¬†Simple</header>
<div id="toolbar">
  <button id="refresh"><span id="refreshLabel">Refresh</span></button>
  <button id="select">Select</button>
  <button id="summarize" disabled>GPT¬†Summarize</button>
  <button id="chat" disabled>Chat¬†with¬†It</button>
  <button class="secondary" id="set-key">üîë¬†API¬†Key</button>
</div>
<ul id="stories"></ul>
<button id="fab"></button>

<!-- Modal -->
<div id="modal"><div class="card">
  <span class="close">&times;</span>
  <header id="modal-title"></header>
  <div id="modal-body"></div>
</div></div>

<div id="toast">Copied</div>

<!-- helper libs -->
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.2/Sortable.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8/hammer.min.js"></script>

<script>
const API_ROOT="https://hacker-news.firebaseio.com/v0",MAX_STORIES=30;
const list=document.getElementById("stories"),
      fab=document.getElementById("fab"),
      btnRefresh=document.getElementById("refresh"),
      btnSelect=document.getElementById("select"),
      btnSum=document.getElementById("summarize"),
      btnChat=document.getElementById("chat"),
      toast=document.getElementById("toast"),
      refreshLabel=document.getElementById("refreshLabel");
let stories=[],selectMode=false;

////////////////////  UTILITIES  ////////////////////
const vibrate=ms=>{try{navigator.vibrate(ms);}catch(e){}};
const showToast=msg=>{toast.textContent=msg;toast.classList.add("show");
  setTimeout(()=>toast.classList.remove("show"),1400);};
function modal(title,html){
  const m=document.getElementById("modal");
  m.style.display="flex";
  document.getElementById("modal-title").textContent=title;
  document.getElementById("modal-body").innerHTML=html;
  m.querySelector(".close").onclick=()=>m.style.display="none";
}
function copy(txt){navigator.clipboard.writeText(txt).then(()=>showToast("Copied"));}

////////////////////  DATA  ////////////////////
async function loadStories(){
  try{
    btnRefresh.disabled=true;refreshLabel.innerHTML='<span class="spin"></span>';
    const ids=await fetch(API_ROOT+"/topstories.json").then(r=>r.json());
    stories=await Promise.all(ids.slice(0,MAX_STORIES)
              .map(id=>fetch(`${API_ROOT}/item/${id}.json`).then(r=>r.json())));
    vibrate(50);
    render();
  }catch(err){
    console.error(err);
    list.innerHTML=`<div class="empty">
       <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 ..."/></svg>
       Failed loading stories.<br><button onclick="loadStories()">Retry</button></div>`;
  }finally{
    refreshLabel.textContent="Refresh";btnRefresh.disabled=false;
  }
}

////////////////////  RENDER  ////////////////////
function render(){
  if(!stories.length){list.innerHTML=`<div class="empty">
      <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 ..."/></svg>
      No stories right now üí§</div>`;return;}
  list.innerHTML="";
  stories.forEach((s,i)=>{
    const li=document.createElement("li");li.className="story";li.dataset.index=i;
    li.innerHTML=`
      <span class="drag-handle" aria-label="Reorder" draggable="false">‚ò∞</span>
      <label class="checkbox"><input type="checkbox"></label>
      <a class="title" href="${s.url||`https://news.ycombinator.com/item?id=${s.id}`}"
        target="_blank" rel="noopener" draggable="false">${s.title}</a>
      <span class="points">${s.score}</span>
      <a class="comments" href="https://news.ycombinator.com/item?id=${s.id}" target="_blank"
         rel="noopener" draggable="false">üí¨</a>
      <div class="swipe-delete"><button class="remove">
         <svg viewBox="0 0 24 24"><path d="M3 6h18v2H3zm2 3h14l-1.5 13h-11z"/></svg>
       </button></div>`;
    list.appendChild(li);wireSwipe(li);
  });

  Sortable.create(list,{
    animation:150,
    handle:".drag-handle",
    onStart:evt=>evt.item.classList.add("dragging"),
    onEnd:evt=>{
      evt.item.classList.remove("dragging");
      const [m]=stories.splice(evt.oldIndex,1);stories.splice(evt.newIndex,0,m);
      vibrate(25);render();
    }
  });
  updateActionButtons();
  if(!selectMode){list.querySelectorAll(".checkbox input").forEach(cb=>cb.checked=false);}
}

function wireSwipe(li){
  const mc=new Hammer(li);mc.get("swipe").set({direction:Hammer.DIRECTION_HORIZONTAL,velocity:0.2});
  mc.on("swipeleft",()=>{li.querySelector(".swipe-delete").style.right="0";});
  mc.on("swiperight",()=>{li.querySelector(".swipe-delete").style.right="-80px";});
  li.querySelector(".remove").onclick=()=>{
    const idx=+li.dataset.index;stories.splice(idx,1);render();vibrate(35);
  };
}

////////////////////  SELECT MODE  ////////////////////
btnSelect.onclick=()=>{
  selectMode=!selectMode;btnSelect.textContent=selectMode?"Done":"Select";
  list.classList.toggle("selecting",selectMode);updateActionButtons();
  vibrate(20);
};
list.addEventListener("change",updateActionButtons);
function selected(){return [...list.children]
  .filter(li=>li.querySelector("input")?.checked)
  .map(li=>stories[li.dataset.index]);}
function updateActionButtons(){
  const sel=selected();const any=sel.length;
  btnSum.disabled=!any;btnChat.disabled=any!==1;
  fab.classList.toggle("show",any);
  fab.textContent=`${any} selected`;
}

fab.onclick=()=>{btnSum.disabled?btnChat.click():btnSum.click();};

////////////////////  KEY MANAGEMENT  ////////////////////
document.getElementById("set-key").onclick=()=>{
  const cur=localStorage.getItem("OPENAI_API_KEY")||"";
  const k=prompt("Paste OpenAI API key (leave blank to clear)",cur);
  if(k===null)return;
  k.trim()?localStorage.setItem("OPENAI_API_KEY",k.trim())
          :localStorage.removeItem("OPENAI_API_KEY");
};

////////////////////  OPENAI / FALLBACK  ////////////////////
async function chatAPI(messages){
  const key=localStorage.getItem("OPENAI_API_KEY");
  const res=await fetch("https://api.openai.com/v1/chat/completions",{
    method:"POST",
    headers:{"Content-Type":"application/json","Authorization":"Bearer "+key},
    body:JSON.stringify({model:"gpt-3.5-turbo-0125",messages,max_tokens:256})
  }).then(r=>r.json());
  if(res.error) throw Error(res.error.message);
  return res.choices[0].message.content.trim();
}

/////////////  SUMMARIZE  /////////////
btnSum.onclick=async()=>{
  const sel=selected();if(!sel.length)return;
  const key=localStorage.getItem("OPENAI_API_KEY");
  if(!key){                 /* prompt‚Äëcopy */
    const prompts=sel.map(a=>`**${a.title}**\nSummarize (${a.url||"N/A"}) in 5 bullets + ELI5.`).join("\n\n");
    modal("Copy to ChatGPT",
      `<textarea readonly rows="12" style="width:100%">${prompts}</textarea>
       <button class="copy-btn" onclick="copy(\`${prompts.replace(/`/g,'\\`')}\`)">Copy üìã</button>`);
    return;
  }
  modal("Summaries","Working‚Ä¶ ‚è≥");
  const outs=[];
  for(const art of sel){
    const msg=[{role:"system",content:"Be a concise summarizer."},
               {role:"user",content:`5 bullets + ELI5 for "${art.title}". URL: ${art.url||"N/A"}`}];
    outs.push(`<h3>${art.title}</h3><p>${await chatAPI(msg)}</p>`);
  }
  document.getElementById("modal-body").innerHTML=outs.join("");
};

/////////////  CHAT  /////////////
btnChat.onclick=()=>{
  const art=selected()[0];if(!art)return;
  const key=localStorage.getItem("OPENAI_API_KEY");
  if(!key){
    const prompt=`You are ChatGPT. The Hacker News story is "${art.title}". Answer my questions about it.`;
    modal("Start a Chat",
      `<textarea readonly rows="7" style="width:100%">${prompt}</textarea>
       <button class="copy-btn" onclick="copy(\`${prompt.replace(/`/g,'\\`')}\`)">Copy üìã</button>`);
    return;
  }
  modal("Chat -- "+art.title,
    `<pre id="chatLog" class="chat-log"></pre>
     <input id="chatInput" placeholder="Ask anything‚Ä¶" style="width:100%;padding:.65rem;border:1px solid #ccc;border-radius:8px;margin-top:.6rem">`);
  const log=document.getElementById("chatLog"),input=document.getElementById("chatInput");
  let history=[{role:"system",content:`You are a helpful assistant. Story: "${art.title}".`}];
  input.addEventListener("keydown",async e=>{
    if(e.key!=="Enter")return;
    const q=input.value.trim();if(!q)return;
    log.textContent+=`\nYou: ${q}`;input.value="";
    history.push({role:"user",content:q});
    const a=await chatAPI(history);history.push({role:"assistant",content:a});
    log.textContent+=`\nAI: ${a}\n`;log.scrollTop=log.scrollHeight;vibrate(25);
  });
};

////////////////////  BOOT  ////////////////////
btnRefresh.onclick=loadStories;
loadStories();
</script>
</body></html>