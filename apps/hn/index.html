<!--  hn-clear.html  – v4  -->
<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>Hacker News – Simple</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css">
<style>
:root{--orange:#ff6600;--radius:12px;--anim:.18s cubic-bezier(.25,.8,.5,1)}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{height:100%;margin:0;font:-apple-system-body;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;background:#f7f7f7}
header{background:var(--orange);color:#fff;padding:.7rem 1.2rem;font-weight:600;font-size:1.2rem}
#toolbar{display:flex;gap:.6rem;padding:.6rem 1rem}
button{background:var(--orange);color:#fff;border:0;border-radius:var(--radius);padding:.55rem .95rem;font-size:1rem;cursor:pointer;transition:opacity var(--anim)}
button:active{opacity:.7}button[disabled]{opacity:.4}button.secondary{background:#dadada;color:#333}
ul#stories{list-style:none;margin:0;padding:0}
li.story{background:#fff;margin:.55rem 0;padding:.9rem 1rem;border-radius:var(--radius);display:flex;align-items:center;gap:.8rem;position:relative;touch-action:none;box-shadow:0 1px 2px rgba(0,0,0,.06);transition:box-shadow var(--anim)}
li.dragging{box-shadow:0 8px 12px rgba(0,0,0,.15);opacity:.9}
.drag-handle{font-size:1.35rem;cursor:grab;user-select:none}
.menu-btn{font-size:1.35rem;cursor:pointer;color:#555;margin-left:auto}
a.title{flex:1;font-size:1rem;font-weight:500;text-decoration:none;color:#000}
.points{background:var(--orange);color:#fff;border-radius:6px;padding:.2rem .55rem;font-size:.75rem}
.checkbox{display:none;margin-right:.3rem}.selecting li .checkbox{display:block}
.checkbox input{width:22px;height:22px}
.swipe-delete{position:absolute;top:0;right:-80px;height:100%;display:flex;align-items:center;padding:0 .8rem;transition:right var(--anim)}
.swipe-delete button{background:#e74c3c;border:0;border-radius:8px;padding:.6rem .9rem;display:flex;align-items:center}
.swipe-delete svg{width:1.1rem;height:1.1rem;fill:#fff}
#fab{position:fixed;bottom:calc(env(safe-area-inset-bottom) + 1rem);left:50%;transform:translateX(-50%);background:var(--orange);color:#fff;border-radius:999px;padding:.6rem 1.4rem;font-weight:600;display:none;box-shadow:0 4px 14px rgba(0,0,0,.2);transition:transform var(--anim)}
#fab.show{display:block}@keyframes fadeIn{from{opacity:0;transform:translate(-50%,1rem)}to{opacity:1}}
#modal{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;padding:1rem;z-index:1000}
#modal .card{background:#fff;border-radius:var(--radius);max-width:650px;width:100%;max-height:90vh;overflow:auto;position:relative;padding:1rem}
#modal header{font-size:1.25rem;font-weight:700;margin-bottom:.4rem}
#modal .close{position:absolute;top:.4rem;right:.8rem;font-size:1.6rem;color:#555;cursor:pointer}
.copy-btn{margin-top:.7rem;background:#2ecc71}
.toast{position:fixed;top:0;left:0;right:0;background:#333;color:#fff;text-align:center;padding:.4rem 0;font-size:.9rem;transform:translateY(-120%);transition:transform var(--anim);z-index:1500}
.toast.show{transform:translateY(0)}
.action-sheet{position:absolute;right:1rem;top:2.7rem;background:#fff;border-radius:10px;box-shadow:0 4px 12px rgba(0,0,0,.2);overflow:hidden;z-index:900}
.action-sheet button{display:block;width:100%;text-align:left;padding:.7rem 1rem;background:#fff;border:0;font-size:.95rem}
.action-sheet button:hover{background:#f2f2f2}
.hidden{display:none}
</style>
</head><body>
<header>Hacker News – Simple</header>
<div id="toolbar">
  <button id="refresh">Refresh</button>
  <button id="select">Select</button>
  <button id="summarize" disabled>GPT Summarize</button>
  <button class="secondary" id="set-key">🔑 API Key</button>
</div>
<ul id="stories"></ul>
<button id="fab"></button>

<!-- Modal -->
<div id="modal"><div class="card">
  <span class="close">&times;</span>
  <header id="modal-title"></header>
  <div id="modal-body"></div>
</div></div>

<div id="toast" class="toast">Copied</div>

<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.2/Sortable.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8/hammer.min.js"></script>
<script>
const API_ROOT="https://hacker-news.firebaseio.com/v0",MAX_STORIES=30;
const list=document.getElementById("stories"),fab=document.getElementById("fab"),
      btnRefresh=document.getElementById("refresh"),btnSelect=document.getElementById("select"),
      btnSum=document.getElementById("summarize"),toast=document.getElementById("toast");
let stories=[],selectMode=false,sortable;

//////////////////// UTIL ////////////////////
const vibrate=n=>{try{navigator.vibrate(n);}catch{}};
const showToast=t=>{toast.textContent=t;toast.classList.add("show");setTimeout(()=>toast.classList.remove("show"),1400);};
function modal(t,html){const m=document.getElementById("modal");m.style.display="flex";
  document.getElementById("modal-title").textContent=t;document.getElementById("modal-body").innerHTML=html;
  m.querySelector(".close").onclick=()=>m.style.display="none";}
const copy=txt=>navigator.clipboard.writeText(txt).then(()=>showToast("Copied"));

//////////////////// DATA ////////////////////
async function loadStories(){
  try{btnRefresh.disabled=true;btnRefresh.innerHTML='⏳';const ids=await fetch(API_ROOT+"/topstories.json").then(r=>r.json());
    stories=await Promise.all(ids.slice(0,MAX_STORIES).map(id=>fetch(`${API_ROOT}/item/${id}.json`).then(r=>r.json())));
    vibrate(50);renderList();
  }catch(e){console.error(e);list.innerHTML="<p style='padding:2rem'>Failed. Tap Refresh.</p>";}
  finally{btnRefresh.disabled=false;btnRefresh.textContent="Refresh";}
}

//////////////////// RENDER ////////////////////
function renderList(){
  list.innerHTML="";
  stories.forEach((s,i)=>{list.appendChild(renderItem(s,i));});
  if(!sortable){
    sortable=Sortable.create(list,{animation:150,handle:".drag-handle",
      onStart:evt=>evt.item.classList.add("dragging"),
      onEnd:evt=>{evt.item.classList.remove("dragging");reindex(evt.oldIndex,evt.newIndex);}
    });
  }
  updateUIState();
}
function renderItem(s,i){
  const li=document.createElement("li");li.className="story";li.dataset.index=i;
  li.innerHTML=`
    <span class="drag-handle" aria-label="Reorder">☰</span>
    <label class="checkbox"><input type="checkbox"></label>
    <a class="title" href="${s.url||`https://news.ycombinator.com/item?id=${s.id}`}" target="_blank">${s.title}</a>
    <span class="points">${s.score}</span>
    <span class="menu-btn">⋯</span>
    <div class="swipe-delete"><button class="remove">🗑</button></div>`;
  wire(li);return li;
}
function reindex(oldI,newI){
  const [m]=stories.splice(oldI,1);stories.splice(newI,0,m);
  [...list.children].forEach((li,idx)=>li.dataset.index=idx);
  vibrate(25);
}

//////////////////// WIRING ////////////////////
function wire(li){
  // swipe
  const mc=new Hammer(li);mc.get("swipe").set({direction:Hammer.DIRECTION_HORIZONTAL,velocity:0.2});
  mc.on("swipeleft",()=>li.querySelector(".swipe-delete").style.right="0");
  mc.on("swiperight",()=>li.querySelector(".swipe-delete").style.right="-80px");
  li.querySelector(".remove").onclick=()=>{stories.splice(li.dataset.index,1);li.remove();updateUIState();vibrate(35);};

  // checkbox
  li.querySelector("input").addEventListener("change",updateUIState);

  // action sheet
  li.querySelector(".menu-btn").onclick=e=>{
    const sheet=document.createElement("div");sheet.className="action-sheet";
    sheet.innerHTML=`<button>Summarize</button><button>Keep only this</button><button>Remove</button>`;
    li.appendChild(sheet);vibrate(15);
    const close=()=>sheet.remove();
    sheet.querySelectorAll("button")[0].onclick=()=>{close();summarizeStories([stories[li.dataset.index]]);}
    sheet.querySelectorAll("button")[1].onclick=()=>{close();keepSelected([li]);}
    sheet.querySelectorAll("button")[2].onclick=()=>{close();li.querySelector(".remove").click();}
    document.addEventListener("click",close,{once:true});
    e.stopPropagation();
  };
}

//////////////////// SELECT & FAB ////////////////////
btnSelect.onclick=()=>{selectMode=!selectMode;btnSelect.textContent=selectMode?"Done":"Select";
  list.classList.toggle("selecting",selectMode);list.querySelectorAll("input").forEach(cb=>cb.checked=false);
  updateUIState();vibrate(20);}
function selectedLis(){return [...list.children].filter(li=>li.querySelector("input").checked);}
function updateUIState(){
  const any=selectedLis().length;
  btnSum.disabled=!any;
  fab.classList.toggle("show",any);
  fab.textContent=any?`${any} selected`:"";
}
fab.onclick=()=>{
  const lis=selectedLis();
  const sheet=document.createElement("div");sheet.className="action-sheet";sheet.style.position="fixed";
  sheet.style.bottom="calc(env(safe-area-inset-bottom)+4.5rem)";sheet.style.left="50%";sheet.style.transform="translateX(-50%)";
  sheet.innerHTML=`<button id="fabSum">Summarize</button><button id="fabKeep">Keep selected</button>`;
  document.body.appendChild(sheet);vibrate(15);
  sheet.querySelector("#fabSum").onclick=()=>{sheet.remove();summarizeStories(lis.map(li=>stories[li.dataset.index]));}
  sheet.querySelector("#fabKeep").onclick=()=>{sheet.remove();keepSelected(lis);}
  document.addEventListener("click",()=>sheet.remove(),{once:true});
};

function keepSelected(lis){
  [...list.children].forEach(li=>li.style.display="none");
  lis.forEach(li=>li.style.display="flex");
  fab.classList.remove("show");btnSum.disabled=true;selectMode=false;btnSelect.textContent="Select";
}

//////////////////// GPT SUMMARY ////////////////////
async function chatAPI(messages){
  const key=localStorage.getItem("OPENAI_API_KEY");
  const r=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",
    headers:{"Content-Type":"application/json","Authorization":"Bearer "+key},
    body:JSON.stringify({model:"gpt-3.5-turbo-0125",messages,max_tokens:400})}).then(r=>r.json());
  if(r.error)throw Error(r.error.message);return r.choices[0].message.content.trim();
}
function buildPrompt(title,url){
  return `Give me:\n• 5 concise bullet points summarizing the article "${title}".\n`+
         `• An analogy or concrete scenario that makes the core idea easy to grasp.\n`+
         `• One sentence on *why this could be interesting or significant*.\n`+
         `URL: ${url||"N/A"}`;
}
async function summarizeStories(arr){
  const key=localStorage.getItem("OPENAI_API_KEY");
  if(!key){
    const txt=arr.map(a=>`**${a.title}**\n${buildPrompt(a.title,a.url)}`).join("\n\n");
    modal("Copy to your LLM",
      `<textarea readonly rows="14" style="width:100%">${txt}</textarea>
       <button class="copy-btn" onclick="copy(\`${txt.replace(/`/g,'\\`')}\`)">Copy 📋</button>`);
    return;
  }
  modal("Summaries","Working… ⏳");const out=[];
  for(const art of arr){
    const m=[{role:"system",content:"Be concise and clear."},{role:"user",content:buildPrompt(art.title,art.url)}];
    out.push(`<h3>${art.title}</h3><p>${await chatAPI(m)}</p>`);
  }
  document.getElementById("modal-body").innerHTML=out.join("");
}

//////////////////// KEY ////////////////////
document.getElementById("set-key").onclick=()=>{
  const cur=localStorage.getItem("OPENAI_API_KEY")||"",k=prompt("Paste key (blank to clear)",cur);
  if(k===null)return;k.trim()?localStorage.setItem("OPENAI_API_KEY",k.trim()):localStorage.removeItem("OPENAI_API_KEY");
};

//////////////////// BOOT ////////////////////
btnRefresh.onclick=loadStories;loadStories();
</script>
</body></html>